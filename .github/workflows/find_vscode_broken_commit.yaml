# Build and find out which commit breaks


# https://github.com/microsoft/vscode/wiki/How-to-Contribute
name: Find vscode broken commit
run-name: Find broken commit
on:
  push:
    paths:
      - ".github/workflows/find_vscode_broken_commit.yaml"
  workflow_dispatch:
    inputs:
      from:
        description: "from"
        default: "HEAD"
        required: true
      depth:
        description: "depth"
        default: "1000"
        required: true
        type: number

jobs:
    get-random-commits:
        runs-on: ubuntu-latest
        outputs:
          commits: ${{ toJson(steps.get_commits.outputs.commits) }}
        steps:
          - name: Checkout repository
            uses: actions/checkout@v2
            with:
              fetch-depth: ${{inputs.depth||'1000'}}
    
          - name: Get 10 random commit IDs
            id: get_commits
            run: |
              # echo "commits=[$(git log -n${{inputs.depth}} --format="%H" | awk 'NR % 100==0' | tr '\n' ',')]">> $GITHUB_OUTPUT
              echo "commits=[a,b,c]">> $GITHUB_OUTPUT


    test_ouput:
      needs: get-random-commits
      runs-on: ubuntu-latest
      steps:
        - name: Test output
          run: |
            echo ${{needs.get-random-commits.outputs.commits}}
    
    reset-to-commit:
        needs: get-random-commits
        runs-on: ubuntu-latest
        strategy:
          matrix:
            commit: ${{ fromJSON('["A", "B", "C"]') }}
        steps:
          - name: Reset to commit
            run: |
                # git reset --hard ${{ matrix.commit }}
                echo "Reset to commit: ${{ matrix.commit }}"
